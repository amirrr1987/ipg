export function validatePanCard(panNumber) {
  // ابتدا ارقام را از اعداد غیرمجاز حذف می‌کنیم
  const sanitizedPan = panNumber.replace(/[^\d]/g, '')

  // بررسی طول صحیح بودن شماره کارت (باید 16 رقم باشد)
  if (sanitizedPan.length !== 16) {
    return 'شماره کارت نامعتبر'
  }

  // محاسبه رقم کنترل
  const panArray = sanitizedPan.split('').map(Number)
  let sum = 0
  for (let i = 0; i < 16; i++) {
    let digit = panArray[i]
    if (i % 2 === 0) {
      digit *= 2
      if (digit > 9) {
        digit -= 9
      }
    }
    sum += digit
  }

  // بررسی رقم کنترل
  if (sum % 10 !== 0) {
    return 'شماره کارت نامعتبر'
  }

  // تشخیص بانک بر اساس پیش شماره
  const first6Digits = sanitizedPan.slice(0, 6)
  const bankLookup = {
    '603799': 'بانک ملی ایران',
    '589210': 'بانک سپه',
    '627648': 'بانک توسعه صادرات',
    '627961': 'بانک صنعت و معدن',
    '603770': 'بانک کشاورزی',
    '628023': 'بانک مسکن',
    '627760': 'پست بانک ایران',
    '502908': 'بانک توسعه تعاون',
    '627412': 'بانک اقتصاد نوین',
    '622106': 'بانک پارسیان',
    '502229': 'بانک پاسارگاد',
    '639599': 'بانک قوامین',
    '627488': 'بانک کارآفرین',
    '621986': 'بانک سامان',
    '639346': 'بانک سینا',
    '639607': 'بانک سرمایه',
    '504706': 'بانک شهر',
    '502806': 'بانک دی',
    '502938': 'بانک دی',
    '603769': 'بانک صادرات',
    '610433': 'بانک ملت',
    '627353': 'بانک تجارت',
    '585983': 'بانک تجارت',
    '589463': 'بانک رفاه',
    '627381': 'بانک انصار',
    '639370': 'بانک مهر اقتصاد',
    '507677': 'موسسه اعتباری نور',
    '628157': 'موسسه اعتباری توسعه',
    '505801': 'موسسه اعتباری کوثر',
    '606256': 'موسسه اعتباری ملل (عسکریه)',
    '606373': 'بانک قرض الحسنه مهرایرانیان'
  }

  if (bankLookup[first6Digits]) {
    return 'شماره کارت معتبر از ' + bankLookup[first6Digits]
  } else {
    return 'شماره کارت معتبر (بدون تعیین بانک)'
  }
}


